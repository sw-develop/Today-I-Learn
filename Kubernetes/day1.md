- 쿠버네티스는 대규모 분산 시스템에서 컨테이너 애플리케이션을 효율적으로 가동시키기 위한 오케스트레이션 툴이다.
- 서버나 네트워크, 스토리지 등과 같은 컴퓨팅 리소스를 운용 관리하는 부담을 줄이고, 엔지니어가 설계나 개발에 전념할 수 있는 기능을 제공한다.

## 📌 쿠버네티스의 핵심 개념 3가지

- Immutable Infrastructure
    - 기존의 인프라 변경 이력 관리 방식이 아닌 한 번 구축한 인프라는 변경할 필요 없이 파기하고 새로운 것을 구축하여 지금 현재 움직이고 있는 인프라의 상태를 관리하는 이러한 인프라를 Immutable Infrastruture라고 한다.


- 선언적 설정
    - 기존처럼 절차나 변경 이력을 관리하는 것이 아니라 시스템의 상태를 관리하는 방식을 취하는 것이 선언적 설정이다.
    - 선언적 설정에서는 시스템이 본래 되어 있어야 할 모습을 정의한다.
        - 쿠버네티스 클러스터는 해당 정의 파일을 보고 그 모습이 되도록 자율적으로 움직인다.


- 자기 복구 기능
    - 위의 2가지의 처리를 수작업이 아닌 컴퓨팅 리소스가 자율적으로 운용할 수 있도록 소프트웨어로 실현한다.
    - 쿠버네티스가 애플리케이션의 상태를 항시 감시하여 이상이 있으면 미리 ‘시스템 본래의 모습’으로 설정된 상태가 되도록 쿠버네티스 자신이 자동으로 API를 사용하여 재시작하거나 클러스터에서 장애를 제거해 시스템을 복구한다.

## 📌 쿠버네티스의 구조 - 주요 관점: 오케스트레이션의 구조를 어떻게 실현하는가?!

- 스케줄링과 디스커버리
    - 스케줄링
        - 어플리케이션을 적절한 곳에 디플로이하는 장치를 스케줄링이라고 한다.
        - 쿠버네티스는 ‘계산 처리가 많아 CPU 많이 사용’, ‘배치 처리이므로 우선순위 낮음’ 등과 같은 요구를 메니페스트 파일로 정의해 이를 바탕으로 클러스터 안의 적절한 위치에 어플리케이션을 자동으로 배치한다.
    - 서비스 디스커버리
        - 디플로이된 어플리케이션이 어디에 있는지를 찾아내는 장치를 서비스 디스커버리라고 한다.
        - 쿠버네티스는 클러스터 안에 구성 레지스트리를 갖고 있어 이를 바탕으로 서비스 디스커버리를 동적으로 수행한다.
        - 마이크로 서비스형 어플리케이션에서 서비스 간의 호출을 서비스 디스커버리가 수행한다.
    

- 쿠버네티스의 서버 구성
    - 스케줄링과 디스커버리를 실현하기 위해 클러스터의 서버 상에서 여러 개의 API가 연계되어 움직인다.
    - 마스터(Master) 서버
        - 쿠버네티스의 클러스터 전체를 관리하는 역할을 담당한다.
        - 클러스터 안의 여러 대의 노드의 리소스 사용 상황을 확인하고 컨테이너를 가동시킬 노드를 자동으로 선택한다.
        - etcd라는 분산 키 밸류 스토어(KVS)를 사용해 클러스터의 구성 정보를 관리한다.
    - 노드(Node) 서버
        - 컨테이너 어플리케이션이 작동하는 서버이다.
          
<img width="535" alt="image" src="https://user-images.githubusercontent.com/69254943/170290953-e36585e3-412e-440b-9416-da4222147bcb.png">
          
- 쿠버네티스의 컴포넌트
    - 각 컴포넌트는 API를 통해 호출한다.
    - 마스터(Master) 서버의 컴포넌트
        - API Server
        - Scheduler
            - 포드를 어느 노드에서 작동시킬지 제어하기 위한 백엔드 컴포넌트이다.
        - Controller Manager
            - 쿠버네티스 클러스터의 상태를 감시하고 본래 되어야 할 상태를 유지하는 백엔드 컴포넌트이다.
        - etcd(데이터스토어)
            - 쿠버네티스 클러스터 구성을 유지하는 분산 KVS이다.
    - 노드(Node) 서버의 컴포넌트
        - 쿠버네티스에서 노드의 역할은 실제로 컨테이너 어플리케이션을 움직여 서비스를 제공하는 것이다.
            - 실제 컨테이너 어플리케이션의 실행은 컨테이너 런타임이 수행한다.
        - kubelet
        - kube-proxy
            - 다양한 중계 및 변환을 수행하는 네트워크 프록시이다.

<img width="484" alt="image" src="https://user-images.githubusercontent.com/69254943/170291355-24a9ea23-100e-48fa-b2f6-d75e4685c3ef.png">


## 📌 쿠버네티스의 리소스

- 쿠버네티스는 어플리케이션 실행 환경 관리를 소프트웨어로 수행하기 때문에 다양한 것을 추상화하고 있고, 이렇게 추상화한 것을 리소스라고 부른다.


- 어플리케이션 실행 관련 리소스 (Pod / ReplicaSet / Deployment)
    - 포드(Pod)
        - 쿠버네티스에서는 여러 개의 컨테이너를 모아 포드로 관리한다.
        - 쿠버네티스에서는 이 포드가 어플리케이션의 디플로이 단위가 되며, 포드 단위로 컨테이너의 작성, 시작, 정지, 삭제 등과 같은 조작을 한다.
    - 리플리카셋(ReplicaSet)
        - 클러스터 안에서 지정된 수의 포드를 가동시켜 두는 장치이다.
        - 항상 필요한 수만큼 포드가 기동된 상태를 클러스터 안에 만드는 역할을 한다.
    - 디플로이먼트(Deployment)
        - 어플리케이션의 배포 단위를 관리하는 것이다.
        - 리플리카셋의 이력을 갖고 있다.
    - 데몬셋(DaemonSet)
    - 스테이트풀셋(StatefulSet)
    

- 네트워크 관리 관련 리소스 (Service / Ingress)
    - Service
        - 쿠버네티스 클러스터 안에서 실행된 포드에 대해 엑세스할 때 서비스를 정의한다.
        - 서비스에 의해 할당되는 IP 주소에는 Cluster IP (프라이빗 IP)와 External IP (공개 IP)가 있다.
    - Ingress
        - 클러스터 외부의 네트워크로부터 액세스를 받기 위한 오브젝트이다.
    

- 어플리케이션 설정 정보 관리 관련 리소스 (ConfigMap / Secrets)
  <img width="664" alt="image" src="https://user-images.githubusercontent.com/69254943/170291810-7b7ad270-c298-449a-8238-bf27902dea3e.png">


- 배치 잡 관리 관련 리소스 (Job / CronJob)

## 📌 매니페스트 파일

- 쿠버네티스는 선언적 설정을 할 때 매니페스트 파일을 사용한다.
- 해당 파일에는 리소스의 구체적인 설정 정보를 담는다.

## 📌 라벨을 사용한 리소스 관리

- 쿠버네티스는 리소스를 관리할 때 라벨을 사용해 식별한다.
- LabelSelector를 사용해 리소스 검색도 가능하다.

## 📌 쿠버네티스의 리소스 분리

- 쿠버네티스에는 리소스를 모아 가상적으로 분리하는 네임스페이스 기능이 있다.