# @Queryλ¥Ό μ‚¬μ©ν•΄ ν•„μ” κ°’λ§ λ°ν™ν•μ—¬ μ‹¤ν–‰ μΏΌλ¦¬ κ°μ„ ν•κΈ°

<br>

## π“ μƒν™©
- μ•μ„ [ApiUserλ¥Ό λ¶€λ¨ ν΄λμ¤λ΅ μƒμ†λ°›λ” ν•νƒλ΅ κ°μ„ ](https://github.com/sw-develop/Today-I-Learn/blob/main/jpa/%EC%83%81%EC%86%8D%EA%B4%80%EA%B3%84%EB%A7%A4%ED%95%91%EC%9C%BC%EB%A1%9C_%EC%97%94%ED%8B%B0%ED%8B%B0_%EC%84%A4%EA%B3%84_%EA%B0%9C%EC%84%A0%ED%95%98%EA%B8%B0.md)ν• μ΄μ  μ¤‘ ν•λ‚κ°€ λ¶€λ¨ ν΄λμ¤μ μ»¬λΌ μ΅°ν μ‹ ν•μ„ ν…μ΄λΈ”(ApiPersonalUser, ApiBizUser)κ³Ό Joinν•μ§€ μ•κ³ , ApiUser ν…μ΄λΈ”(λ¶€λ¨ ν΄λμ¤)μ„ ν†µν•΄μ„λ§ μ΅°νν•λ” μΏΌλ¦¬λ¥Ό μ‚¬μ©ν•κΈ° λ•λ¬Έμ΄μ—λ‹¤.
- Spring Data JPAμ—μ„ μ κ³µν•λ” λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ ApiUser μ—”ν‹°ν‹° μ΅°ν μ‹ μ‹¤ν–‰λλ” μΏΌλ¦¬λ¥Ό ν™•μΈν•΄λ³΄λ‹ ν•μ„ ν…μ΄λΈ” λ¨λ‘μ™€ left outer joinμ„ ν•λ” κ²ƒμ„ μ•κ² λμ—λ‹¤.
- ν•μ„ ν…μ΄λΈ”μ λ°μ΄ν„°λ” μ‚¬μ©ν•μ§€ μ•μΌλ―€λ΅ μμƒκ³Ό λ‹¤λ¥΄κ² λ¶ν•„μ”ν• join μΏΌλ¦¬κ°€ λ°μƒν•λ” κ²ƒμ΄μ—λ‹¤.

<br>

**μν–‰ μΏΌλ¦¬ ν™•μΈ**
```java
public interface ApiUserRepository extends JpaRepository<ApiUser, Long> {
		
    Optional<ApiUser> findByAppId(String appId); //1

    @Query("select au " +
            "from ApiUser au " +
            "where au.appId = :appId")
    Optional<ApiUser> findByAppId(String appId); //2
}
```
- 1κ³Ό 2 λ¨λ‘ μ•„λμ μΏΌλ¦¬κ°€ μ‹¤ν–‰λλ‹¤.

![image](https://user-images.githubusercontent.com/69254943/183848835-6bbc8736-db41-40da-a425-6c1adaabfff7.png)

<br>

## π“ κ°μ„ 
- ApiUserλ¥Ό ν†µν•΄ λ°ν™λλ” κ°’ μ¤‘ ν•„μ”ν• κ²ƒμ€ ApiUserμ id κ°’μ΄λ―€λ΅, @Queryλ¥Ό μ‚¬μ©ν•΄ ν•΄λ‹Ή κ°’λ§ λ°ν™ν•λ„λ΅ ν•μ€λ‹¤.

<br>

**μν–‰ μΏΌλ¦¬ ν™•μΈ**
```java
public interface ApiUserRepository extends JpaRepository<ApiUser, Long> {
		
    @Query("select au.id " +
            "from ApiUser au " +
            "where au.appId = :appId")
    Long findIdByAppId(String appId);
}
```

![image](https://user-images.githubusercontent.com/69254943/183850429-cc7f26bf-6a27-4106-ad23-5f329bec7526.png)

- μλ„ν•λ€λ΅ joinμ„ μ‚¬μ©ν•μ§€ μ•κ³ , ApiUser ν…μ΄λΈ”μ—μ„λ§ μ΅°νν•λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

<br>

## π“ λλ‚€μ 
- μμƒκ³Ό λ‹¤λ¥΄κ² μΏΌλ¦¬κ°€ μ‹¤ν–‰λ  μ μλ‹¤λ” κ²ƒμ„ λ‹¤μ‹ν•λ² κΉ¨λ‹¬μ•λ‹¤. ν…μ¤νΈ μ½”λ“λ¥Ό μ§λ©° μΏΌλ¦¬λ¥Ό ν™•μΈν•κΈΈ μν• κ²ƒ κ°™λ‹¤.



